<%- include('../partials/header', { nav: { current: '/actors' }, title: 'Actors' }) %>

<div class="container container-narrow py-3 actors-table">
    <div class="d-flex align-items-center justify-content-between mb-2">
        <h1 class="h4 mb-0">Actors</h1>

        <% if (currentUser) { %>
            <a class="btn btn-sm btn-success" href="/actors/new">New</a>
        <% } %>
    </div>

    <!-- search -->
    <form class="row g-2 mb-3" method="get" action="/actors">
        <div class="col-sm-8 col-md-9">
            <input
                    type="text"
                    name="q"
                    value="<%= q || '' %>"
                    class="form-control"
                    placeholder="Search first/last name..." />
        </div>
        <div class="col-sm-4 col-md-3 d-flex gap-2">
            <button class="btn btn-primary w-100" type="submit">Search</button>
            <a class="btn btn-outline-light w-100" href="/actors">Reset</a>
        </div>
    </form>

    <% if (q && (!items || !items.length)) { %>
        <div class="alert alert-info">No actors found for “<strong><%= q %></strong>”.</div>
    <% } %>

    <table class="table table-hover align-middle">
        <thead class="table-head position-sticky top-0">
        <tr>
            <th style="width:70px;">ID</th>
            <th>First</th>
            <th>Last</th>
            <th style="width:220px;">Last update</th>
            <th style="width:180px;" class="text-end">Actions</th>
        </tr>
        </thead>
        <tbody>
        <%
        var fmt = (typeof formatDateTime === 'function')
                ? formatDateTime
                : function(x){ return x; };

        (items || []).forEach(function(a){
        %>
            <tr>
                <td><%= a.actor_id %></td>
                <td><%= a.first_name %></td>
                <td><%= a.last_name %></td>
                <td><%= fmt(a.last_update) %></td>
                <td class="text-end">
                    <div class="d-inline-flex gap-1">
                        <a class="btn btn-sm btn-outline-light" href="/actors/<%= a.actor_id %>">View</a>

                        <% if (currentUser) { %>
                            <a class="btn btn-sm btn-warning" href="/actors/<%= a.actor_id %>/edit">Edit</a>
                            <form method="post" action="/actors/<%= a.actor_id %>/delete" class="d-inline">
                                <button type="submit" class="btn btn-sm btn-danger"
                                        onclick="return confirm('Delete this actor?')">Delete</button>
                            </form>
                        <% } %>
                    </div>
                </td>
            </tr>
        <% }) %>

        <% if (!items || !items.length) { %>
            <tr><td colspan="5" class="text-center text-muted py-4">No data.</td></tr>
        <% } %>
        </tbody>
    </table>

    <%
    var __page  = (typeof page  !== 'undefined' ? page  : 1);
    var __pages = (typeof pages !== 'undefined' ? pages : 1);
    var pagerModel = (typeof pager !== 'undefined' && pager)
            ? pager
            : {
                page: __page,
                pages: __pages,
                hasPrev: __page > 1,
                hasNext: __page < __pages,
                prev: Math.max(1, __page - 1),
                next: Math.min(__pages, __page + 1),
                items: []
            };

    var tpl = '/actors?page=__p__' + (q ? '&q=' + encodeURIComponent(q) : '');
    %>
    <%- include('../partials/pager', { pager: pagerModel, pageUrlTemplate: tpl }) %>
</div>

<%- include('../partials/footer') %>
