<%- include('../partials/header') %>

<div class="container container-narrow mt-4">

    <!-- Title row -->
    <div class="d-flex align-items-center justify-content-between mb-2">
        <div>
            <h1 class="mb-0">Actors</h1>
            <div class="small text-secondary"><%= total %> results</div>
        </div>

        <div class="d-flex gap-2">
            <% /* optional: link to films for quick switch */ %>
            <a class="btn btn-outline-secondary btn-sm" href="/films">Browse films</a>

            <% if (currentUser && (currentUser.role === 'staff' || currentUser.role === 'admin')) { %>
                <a class="btn btn-primary btn-sm" href="/actors/new">
                    <i class="bi bi-plus-lg me-1"></i> New actor
                </a>
            <% } %>
        </div>
    </div>

    <!-- Search -->
    <form class="row g-2 align-items-center mb-3" method="get" action="/actors">
        <div class="col-md-10">
            <input name="q" value="<%= q || '' %>" class="form-control" placeholder="Search first/last nameâ€¦">
        </div>
        <div class="col-md-2 d-grid">
            <button class="btn btn-primary">Search</button>
        </div>
    </form>

    <!-- Table -->
    <div class="table-responsive">
        <table class="table table-sm table-hover align-middle actors-table">
            <thead class="table-head sticky-top">
            <tr>
                <th class="text-secondary fw-semibold small" style="width:72px;">ID</th>
                <th class="text-secondary fw-semibold small">Name</th>
                <th class="text-secondary fw-semibold small">Last update</th>
                <th class="text-secondary fw-semibold small text-end" style="width:220px;">Actions</th>
            </tr>
            </thead>
            <tbody>
            <% items.forEach(function(a){
                const initials = (a.first_name?.[0] || '') + (a.last_name?.[0] || '');
            %>
            <tr>
                <td>
                    <a href="/actors/<%= a.actor_id %>" class="text-decoration-none">
                        <span class="badge bg-dim text-secondary me-2">#<%= a.actor_id %></span>
                    </a>
                </td>

                <td>
                    <div class="d-flex align-items-center gap-2">
                        <span class="avatar avatar-xs"><%= initials.toUpperCase() %></span>
                        <div>
                            <a href="/actors/<%= a.actor_id %>" class="fw-semibold text-decoration-none text-light">
                                <%= a.first_name %> <%= a.last_name %>
                            </a>
                            <div class="small text-secondary">Actor</div>
                        </div>
                    </div>
                </td>

                <td class="small text-secondary">
                    <%= a.last_update %>
                </td>

                <td class="text-end">
                    <div class="btn-group btn-group-sm" role="group" aria-label="Actions">
                        <a class="btn btn-outline-secondary" href="/actors/<%= a.actor_id %>">View</a>
                        <% if (currentUser && (currentUser.role === 'staff' || currentUser.role === 'admin')) { %>
                            <a class="btn btn-outline-warning" href="/actors/<%= a.actor_id %>/edit">Edit</a>
                            <form class="d-inline" method="post" action="/actors/<%= a.actor_id %>/delete" onsubmit="return confirm('Delete this actor?');">
                                <button class="btn btn-outline-danger" type="submit">Delete</button>
                            </form>
                        <% } %>
                    </div>
                </td>
            </tr>
            <% }) %>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <%
    function pageUrl(p){
        const u = new URLSearchParams();
        if (q) u.set('q', q);
        u.set('page', p);
        return '/actors?' + u.toString();
    }

    const tpl = new URLSearchParams();
    if (q) tpl.set('q', q);
    tpl.set('page', '__PAGE__');
    const pageUrlTemplate = '/actors?' + tpl.toString();
    %>
    <%- include('../partials/pager', { pager, pageUrl, pageUrlTemplate }) %>

</div>

<%- include('../partials/footer') %>
