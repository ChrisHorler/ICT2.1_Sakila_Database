<%- include('../partials/header', { nav: { current: '/films' }, title: 'Films' }) %>

<div class="container container-narrow py-3">
    <div class="d-flex flex-wrap gap-2 align-items-end mb-3">
        <form class="row g-2" method="get" action="/films">
            <div class="col-auto">
                <input class="form-control" type="text" name="q" value="<%= q || '' %>" placeholder="Search title…">
            </div>
            <div class="col-auto">
                <select class="form-select" name="category_id">
                    <option value="">All categories</option>
                    <% (categories || []).forEach(function(c){ %>
                        <option value="<%= c.category_id %>" <%= (+category_id === +c.category_id) ? 'selected' : '' %>><%= c.name %></option>
                    <% }) %>
                </select>
            </div>
            <div class="col-auto">
                <button class="btn btn-primary">Filter</button>
            </div>
        </form>

        <% if (currentUser) { %>
            <a class="btn btn-outline-light ms-auto" href="/films/new">+ New film</a>
        <% } %>
    </div>

    <% if (!items || !items.length) { %>
        <div class="alert alert-secondary">No films match your filters.</div>
    <% } %>

    <ul class="list-group catalog-list">
        <% (items || []).forEach(function(f){
            var poster = (f.title || '').toUpperCase().replace(/\s+/g,'_').replace(/[^A-Z0-9_]/g,'') + '.png';
        %>
        <li class="list-group-item catalog-row">
            <div class="row align-items-center g-3">
                <div class="col-auto">
                    <img class="poster-thumb rounded" src="/posters/<%= poster %>" alt="" onerror="this.src='/posters/placeholder.png'">
                </div>
                <div class="col">
                    <div class="d-flex align-items-center gap-2">
                        <a class="h6 mb-0" href="/films/<%= f.film_id %>"><%= f.title %></a>
                        <span class="badge-soft"><%= f.language %></span>
                    </div>
                    <div class="desc-clamp mt-1"><%= f.description || '' %></div>
                </div>
                <div class="col-auto text-end">
                    <div class="price-badge mb-2">€ <%= Number(f.rental_rate || 0).toFixed(2) %></div>
                    <% if (currentUser) { %>
                        <div class="d-flex gap-2 justify-content-end">
                            <a class="btn btn-sm btn-outline-light" href="/films/<%= f.film_id %>/edit">Edit</a>
                            <form method="post" action="/films/<%= f.film_id %>/delete" onsubmit="return confirm('Delete this film?');">
                                <button class="btn btn-sm btn-outline-light">Delete</button>
                            </form>
                        </div>
                    <% } %>
                </div>
            </div>
        </li>
        <% }) %>
    </ul>

    <%- include('../partials/pager', { pager, pageUrlTemplate }) %>
</div>

<%- include('../partials/footer') %>
